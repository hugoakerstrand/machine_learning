---
title: "Mclust"
author: "Hugo Akerstrand"
date: "2024-12-09"
output: 
  html_document: 
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mclust)
library(flowCore)
library(tidyverse)
library(patchwork)
library(tidymodels)
data("GvHD")
```

## Mclust

An R package implementing Gaussian Mixture Modelling for Model-Based Clustering, Classification, and Density Estimation, <https://mclust-org.github.io/mclust/index.html>.

Start by loading the data and make it into a tibble with the relevant list columns

```{r, echo = TRUE}
data(GvHD)
gvhd_tibble <- tibble(
  exprs = purrr::map(GvHD, ~ exprs(.x)),                       # This contains detector information
  keywords = purrr::map(GvHD, ~ keyword(.x)),                  # This contains meta data
  exprs_tibble = purrr::map(exprs, function(.x) as_tibble(.x)) # This is for plotting
)

head(gvhd_tibble)
```

We will start with doing the 'cell gate' using `FSC-H` and `SSC-H` columns. First inspect the data:

```{r, echo = TRUE}
plot_list <- gvhd_tibble$exprs_tibble |> purrr::map(function(.x) {
      ggplot(data= .x, aes(x = `FSC-H`, y = `SSC-H`)) +
        geom_hex()
    }
  )

wrap_plots(plot_list[1:4])
```
```{r, echo=FALSE}
gvhd_tibble <- gvhd_tibble |> mutate(
  initial_split = purrr::map(exprs_tibble, ~ initial_split(.x, strata = `FSC-H`, prop = 0.8)),
  training = purrr::map(initial_split, ~ training(.x)),
  test = purrr::map(initial_split, ~ testing(.x))
)
```

